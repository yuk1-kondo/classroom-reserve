# Roadmap (今後の展開)

本プロジェクトの今後の改善計画。優先度と意図を短くまとめています。

## ✅ 最近の完了事項（要約）
- 時限ラベルの正規化・表示統一（範囲/複数時限対応）
- 予約データの削除・正規化の堅牢化
- 予約重複検知の改善（Strategy B: 日付/教室変更時のみリセット）
- テーマ更新（薄い紺系ヘッダー/フッター）と UI 調整
- 日別予約テーブルの単線グリッド化（二重線解消）
- 表示順の統一：
  - カレンダーイベント:「時限 教室名」
  - 日別テーブル列:「時限 / 教室 / 時間 / 予約内容 / 予約者」

---

## P1: セキュリティ強化（最優先）
- 管理者権限のクライアント保持を廃止 → Firebase Auth Custom Claims へ移行
- 許可ドメインは Firebase Auth Blocking Functions で強制
- Firestore Security Rules での厳密化：
  - スキーマ/型（period 正規化、所有者/教室IDの整合）
  - 予約時間の整合（開始<終了、営業時間帯など）
- localStorage の権限情報は撤去

## P2: エラーハンドリング / ロギング（中）
- alert を廃止し、トースト/モーダルで統一（例: react-hot-toast）
- ロガー導入（log/info/warn/error） + NODE_ENV で出力制御
- 重要イベントは将来の監視基盤（Sentry 等）へ拡張可能に

## P3: UI/コード整備（中）
- SidePanel の責務分割：
  - CSV エクスポート
  - CSV インポート
  - 一括削除/クレンジング
  - 管理系ユーティリティ
- ReservationForm 最適化：教室リストのソートを useMemo でメモ化、もしくは並び順をサーバー側に持たせる
- クリンナップ：未使用 `SakuraIcon` の削除、テーブル CSS の色を変数へ統一
- ESLint 警告解消：`useConflictDetection` の `checkForConflicts` を `useCallback` で安定化

## P4: テスト基盤（中）
- ユニットテスト（優先順）
  - `utils/periodLabel`（単一/範囲/複数/境界ケース）
  - 重複検知（同一・隣接・跨ぎ・日付変更）
- スモークテスト
  - `CalendarComponent` / `DailyReservationTable` のレンダリングと基本相互作用
- 将来: 主要フローの E2E（予約作成/編集/削除）

## P5: 運用/ドキュメント（低）
- CHANGELOG の更新（テーマ/ボーダー/表記順の最終反映）
- CONTRIBUTING / コーディング規約の追加（命名、状態管理、ロギング方針）
- Secrets/環境構成の方針を docs に明記

---

## メモ（非機能要件）
- パフォーマンス: 取得範囲のキャッシュ、不要再取得の抑制（既に一部実装）
- アクセシビリティ: フォーカスリング/コントラストの継続改善
- 印刷/CSV 出力の整合（表示と出力のラベル一致）

---

更新日: 2025-08-17
